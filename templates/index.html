{% extends './base.html' %} {% block content %}
<title>FIHO - Hệ thống tư vấn gợi ý nhà ở</title>
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class="alert alert-light text-recommend text-center" role="alert">
        NHẬP YÊU CẦU ĐỂ CHÚNG TÔI GIÚP BẠN TÌM
    </div>
</div>

<div class="col-xs-12 col-sm-12 col-md-12 col-lg-6 mt-3">
    <div class="form-wapper">
        <div class="card">
            <form method="POST" id="formRecommend">
                <div class="card-body">
                    <div class="form-group">
                        <label for="district">Quận</label>
                        <select
                            class="form-control"
                            id="district"
                            name="district"
                        >
                            <option {%if districtSelected == 0%}selected{%endif%} value="1">Ninh Kiều</option>
                            <option {%if districtSelected == 1%}selected{%endif%} value="2">Cái Răng</option>
                            <option {%if districtSelected == 2%}selected{%endif%} value="3">Bình Thủy</option>
                            <option {%if districtSelected == 3%}selected{%endif%} value="4">Ô Môn</option>
                            <option {%if districtSelected == 4%}selected{%endif%} value="5">Thốt Nốt</option>
                            <option {%if districtSelected == 5%}selected{%endif%} value="6">Vĩnh Thạnh</option>
                            <option {%if districtSelected == 6%}selected{%endif%} value="7">Thới Lai</option>
                            <option {%if districtSelected == 7%}selected{%endif%} value="8">Cờ Đỏ</option>
                            <option {%if districtSelected == 8%}selected{%endif%} value="9">Phong Điền</option>
                        </select>
                        <small class="form-text text-muted"
                            >Hiện tại chúng tôi chỉ hỗ trợ các quận huyện ở
                            thành phố Cần Thơ thôi nha.</small
                        >
                    </div>
                    <div class="form-row">
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                            <div class="form-group">
                                <label for="price">Giá</label>
                                <select
                                    class="form-control"
                                    id="price"
                                    name="price"
                                >
                                    <span id="slider_label"></span>
                                    <option {%if priceSelected == 0%}selected{%endif%} value="0">Thỏa thuận</option>
                                    <option {%if priceSelected == 1%}selected{%endif%} value="250000000"> Dưới 500 triệu</option>
                                    <option {%if priceSelected == 2%}selected{%endif%} value="650000000">500-800 triệu</option>
                                    <option {%if priceSelected == 3%}selected{%endif%} value="900000000">800-1 tỷ</option>
                                    <option {%if priceSelected == 4%}selected{%endif%} value="2000000000">1-3 tỷ</option>
                                    <option {%if priceSelected == 5%}selected{%endif%} value="4000000000">3-5 tỷ</option>
                                    <option {%if priceSelected == 6%}selected{%endif%} value="6000000000">5-7 tỷ</option>
                                    <option {%if priceSelected == 7%}selected{%endif%} value="8500000000">7-10 tỷ</option>
                                    <option {%if priceSelected == 8%}selected{%endif%} value="15000000000">10-20 tỷ</option>
                                    <option {%if priceSelected == 9%}selected{%endif%} value="25000000000">20-30 tỷ</option>
                                    <option {%if priceSelected == 10%}selected{%endif%} value="50000000000">Trên 30 tỷ</option>
                                </select>
                            </div>
                            <label for="priceUp"
                                >Ưu tiên giá (<span id="slider_label_price"
                                    >{%if priceUp%}{{priceUp}}{%endif%}</span
                                >)</label
                            >
                            <input
                                type="range"
                                class="custom-range"
                                min="1"
                                max="5"
                                step="1"
                                value={%if priceUp%}{{priceUp}}{%endif%}
                                id="priceUp"
                                name="priceUp"
                            />
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6">
                            <div class="form-group">
                                <label for="area">Diện tích</label>
                                <select
                                    class="form-control"
                                    id="area"
                                    name="area"
                                >
                                    <option {%if areaSelected == 0%}selected{%endif%} value="0">Chưa xác định</option>
                                    <option {%if areaSelected == 1%}selected{%endif%} value="25">Dưới 30 m²</option>
                                    <option {%if areaSelected == 2%}selected{%endif%} value="40">30-50 m²</option>
                                    <option {%if areaSelected == 3%}selected{%endif%} value="60">50-70 m²</option>
                                    <option {%if areaSelected == 4%}selected{%endif%} value="85">70-100 m²</option>
                                    <option {%if areaSelected == 5%}selected{%endif%} value="125">100-150 m²</option>
                                    <option {%if areaSelected == 6%}selected{%endif%} value="175">150-200 m²</option>
                                    <option {%if areaSelected == 7%}selected{%endif%} value="250">200-300 m²</option>
                                    <option {%if areaSelected == 8%}selected{%endif%} value="350">200-500 m²</option>
                                    <option {%if areaSelected == 9%}selected{%endif%} value="750">500-1000 m²</option>
                                    <option {%if areaSelected == 10%}selected{%endif%} value="1200">Trên 1000 m²</option>
                                </select>
                            </div>
                            <label for="areaUp"
                                >Ưu tiên diện tích (<span id="slider_label_area"
                                    >{%if areaUp%}{{areaUp}}{%endif%}</span
                                >)</label
                            >
                            <input
                                type="range"
                                class="custom-range"
                                min="1"
                                max="5"
                                step="1"
                                value={%if areaUp%}{{areaUp}}{%endif%}
                                id="areaUp"
                                name="areaUp"
                            />
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
                            <div class="form-group">
                                <label for="floors">Số tầng</label>
                                <select
                                    class="form-control"
                                    id="floors"
                                    name="floors"
                                >
                                    <option {%if floorsSelected == 0%}selected{%endif%} value="0">Chưa xác định</option>
                                    <option {%if floorsSelected == 1%}selected{%endif%} value="1">1</option>
                                    <option {%if floorsSelected == 2%}selected{%endif%} value="2">2</option>
                                    <option {%if floorsSelected == 3%}selected{%endif%} value="3">3</option>
                                    <option {%if floorsSelected == 4%}selected{%endif%} value="4">4</option>
                                    <option {%if floorsSelected == 5%}selected{%endif%} value="5">5</option>
                                    <option {%if floorsSelected == 6%}selected{%endif%} value="6">6</option>
                                    <option {%if floorsSelected == 7%}selected{%endif%} value="7">7</option>
                                    <option {%if floorsSelected == 8%}selected{%endif%} value="8">8</option>
                                    <option {%if floorsSelected == 9%}selected{%endif%} value="9">9</option>
                                    <option {%if floorsSelected == 10%}selected{%endif%} value="10">9+</option>
                                </select>
                            </div>
                            <label for="floorsUp"
                                >Ưu tiên tầng (<span id="slider_label_floors"
                                    >{%if floorsUp%}{{floorsUp}}{%endif%}</span
                                >)</label
                            >
                            <input
                                type="range"
                                class="custom-range"
                                min="1"
                                max="5"
                                step="1"
                                value={%if floorsUp%}{{floorsUp}}{%endif%}
                                id="floorsUp"
                                name="floorsUp"
                            />
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
                            <div class="form-group">
                                <label for="bedrooms">Số phòng ngủ (PN)</label>
                                <select
                                    class="form-control"
                                    id="bedrooms"
                                    name="bedrooms"
                                >
                                    <option {%if bedroomsSelected == 0%}selected{%endif%} value="0">Chưa xác định</option>
                                    <option {%if bedroomsSelected == 1%}selected{%endif%} value="1">1</option>
                                    <option {%if bedroomsSelected == 2%}selected{%endif%} value="2">2</option>
                                    <option {%if bedroomsSelected == 3%}selected{%endif%} value="3">3</option>
                                    <option {%if bedroomsSelected == 4%}selected{%endif%} value="4">4</option>
                                    <option {%if bedroomsSelected == 5%}selected{%endif%} value="5">5</option>
                                    <option {%if bedroomsSelected == 6%}selected{%endif%} value="6">6</option>
                                    <option {%if bedroomsSelected == 7%}selected{%endif%} value="7">7</option>
                                    <option {%if bedroomsSelected == 8%}selected{%endif%} value="8">8</option>
                                    <option {%if bedroomsSelected == 9%}selected{%endif%} value="9">9</option>
                                    <option {%if bedroomsSelected == 10%}selected{%endif%} value="10">9+</option>
                                </select>
                            </div>
                            <label for="bedroomsUp"
                                >Ưu tiên PN (<span id="slider_label_beds"
                                    >{%if bedroomsUp%}{{bedroomsUp}}{%endif%}</span
                                >)</label
                            >
                            <input
                                type="range"
                                class="custom-range"
                                min="1"
                                max="5"
                                step="1"
                                value={%if bedroomsUp%}{{bedroomsUp}}{%endif%}
                                id="bedroomsUp"
                                name="bedroomsUp"
                            />
                        </div>
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
                            <div class="form-group">
                                <label for="direction">Hướng nhà (HN)</label>
                                <select
                                    class="form-control"
                                    id="direction"
                                    name="direction"
                                >
                                    <option {%if directionSelected == 0%}selected{%endif%} value="0">Chưa xác định</option>
                                    <option {%if directionSelected == 1%}selected{%endif%} value="1">Đông</option>
                                    <option {%if directionSelected == 2%}selected{%endif%} value="2">Tây</option>
                                    <option {%if directionSelected == 3%}selected{%endif%} value="3">Nam</option>
                                    <option {%if directionSelected == 4%}selected{%endif%} value="4">Bắc</option>
                                    <option {%if directionSelected == 5%}selected{%endif%} value="5">Đông-Bắc</option>
                                    <option {%if directionSelected == 6%}selected{%endif%} value="6">Tây-Bắc</option>
                                    <option {%if directionSelected == 7%}selected{%endif%} value="7">Đông-Nam</option>
                                    <option {%if directionSelected == 8%}selected{%endif%} value="8">Tây-Nam</option>
                                </select>
                            </div>
                            <label for="directionUp"
                                >Ưu tiên HN (<span id="slider_label_direc"
                                    >{%if directionUp%}{{directionUp}}{%endif%}</span
                                >)</label
                            >
                            <input
                                type="range"
                                class="custom-range"
                                min="1"
                                max="5"
                                step="1"
                                value={%if directionUp%}{{directionUp}}{%endif%}
                                id="directionUp"
                                name="directionUp"
                            />
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="placesNearby">Địa điểm lân cận</label>
                        <input
                            type="text"
                            class="form-control"
                            id="placesNearby"
                            name="placesNearby"
                            placeholder="Nhà hàng, quán cà phê, công viên"
                            value="{%if placesNearby%}{{placesNearby}}{%endif%}"
                            required
                        />
                        <small
                            id="placesNearbyHelp"
                            class="form-text text-muted"
                            >Nhập địa điểm đại diện đừng nhập địa điểm riêng nha
                            bạn.</small
                        >
                    </div>
                    <div class="text-center">
                        <button
                            type="submit"
                            class="btn btn-info"
                            onclick="myFunction()"
                            id="button-submit"
                        >
                            Gợi ý nào !
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="col-xs-12 col-sm-12 col-md-12 col-lg-6 mt-3">
    <div class="form-wapper card-wapper">
        <div class="card card-slider">
            <div id="result"></div>
            <style>
                #map {
                    width: 100%;
                    height: 582px;
                }
            </style>
            <div id="{{result}}"></div>
            {%if data != "empty"%}
            <div
                id="carouselExampleCaptions"
                class="carousel slide"
                data-ride="carousel"
            >
                <ol class="carousel-indicators wapper-small-img">
                    <li
                        data-target="#carouselExampleCaptions"
                        data-slide-to="0"
                        class="active li-size"
                    >
                        <img
                            src="https://www.demoapus-wp1.com/homeo/wp-content/uploads/2020/03/los.jpg"
                            class="d-inline-block align-top small-img img-fluid"
                            alt="FIHO"
                        />
                        <h4 class="text-top">TOP 1</h4>
                    </li>
                    <li
                        data-target="#carouselExampleCaptions"
                        data-slide-to="1"
                        class="li-size"
                    >
                        <img
                            src="https://www.demoapus-wp1.com/homeo/wp-content/uploads/2020/03/los.jpg"
                            class="d-inline-block align-top small-img img-fluid"
                            alt="FIHO"
                        />
                        <h4 class="text-top">TOP 2</h4>
                    </li>
                    <li
                        data-target="#carouselExampleCaptions"
                        data-slide-to="2"
                        class="li-size"
                    >
                        <img
                            src="https://www.demoapus-wp1.com/homeo/wp-content/uploads/2020/03/los.jpg"
                            class="d-inline-block align-top small-img img-fluid"
                            alt="FIHO"
                        />
                        <h4 class="text-top">TOP 3</h4>
                    </li>
                    <li
                        data-target="#carouselExampleCaptions"
                        data-slide-to="3"
                        class="li-size"
                    >
                        <img
                            src="https://www.demoapus-wp1.com/homeo/wp-content/uploads/2020/03/los.jpg"
                            class="d-inline-block align-top small-img img-fluid"
                            alt="FIHO"
                        />
                        <h4 class="text-top">TOP 4</h4>
                    </li>
                    <li
                        data-target="#carouselExampleCaptions"
                        data-slide-to="4"
                        class="li-size"
                    >
                        <img
                            src="https://www.demoapus-wp1.com/homeo/wp-content/uploads/2020/03/los.jpg"
                            class="d-inline-block align-top small-img img-fluid"
                            alt="FIHO"
                        />
                        <h4 class="text-top">TOP 5</h4>
                    </li>
                </ol>
                <div class="carousel-inner">
                    {%for home in range(0, 1)%}
                    <div class="carousel-item active">
                        <a target="_blank" href="./detail/{{data[home][0]}}">
                            <img
                            src="{{data[home][9].split(',')[0].split("'")[1]}}"
                            class="d-block w-100 big-img"
                            alt="{{data[home][8][0]}}" />
                            <div
                                class="carousel-caption d-none d-md-block content-top"
                            >
                                <h6>
                                    <div class="home-property">
                                        <i
                                            class="fas fa-map-marker-alt mr-2"
                                        ></i
                                        >{{data[home][7]}}
                                    </div>
                                </h6>
                            </div>
                            <div
                                class="carousel-caption d-none d-md-block content-home"
                            >
                                <h4>{{(data[home][1])[0:35]}}...</h4>
                                <div class="home-properties">
                                    <div class="home-property">
                                        <i class="fas fa-dollar-sign mr-2"></i
                                        >{{data[home][2]}}
                                    </div>
                                    <div class="home-property">
                                        <i
                                            class="fas fa-ruler-combined mr-2"
                                        ></i
                                        >{{data[home][3]}}
                                    </div>
                                    <div class="home-property">
                                        <i class="fas fa-building mr-2"></i
                                        >{{data[home][5]}}
                                    </div>
                                    <div class="home-property">
                                        <i class="fas fa-bed mr-2"></i
                                        >{{data[home][4]}}
                                    </div>
                                    <div class="home-property">
                                        <i class="fas fa-compass mr-2"></i
                                        >{{data[home][6]}}
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {%endfor%} {%for home2 in range(1, lenData)%}
                    <div class="carousel-item">
                        <a target="_blank" href="./detail/{{data[home2][0]}}">
                            <img
                            src="{{data[home2][9].split(',')[0].split("'")[1]}}"
                            class="d-block w-100 big-img"
                            alt="{{data[home2][8][0]}}" />
                            <div
                                class="carousel-caption d-none d-md-block content-top"
                            >
                                <h6>
                                    <div class="home-property">
                                        <i
                                            class="fas fa-map-marker-alt mr-2"
                                        ></i
                                        >{{data[home2][7]}}
                                    </div>
                                </h6>
                            </div>
                            <div
                                class="carousel-caption d-none d-md-block content-home"
                            >
                                <h4>{{(data[home2][1])[0:35]}}...</h4>
                                <div class="home-properties">
                                    <div class="home-property">
                                        <i class="fas fa-dollar-sign mr-2"></i
                                        >{{data[home2][2]}}
                                    </div>
                                    <div class="home-property">
                                        <i
                                            class="fas fa-ruler-combined mr-2"
                                        ></i
                                        >{{data[home2][3]}}
                                    </div>
                                    <div class="home-property">
                                        <i class="fas fa-building mr-2"></i
                                        >{{data[home2][5]}}
                                    </div>
                                    <div class="home-property">
                                        <i class="fas fa-bed mr-2"></i
                                        >{{data[home2][4]}}
                                    </div>
                                    <div class="home-property">
                                        <i class="fas fa-compass mr-2"></i
                                        >{{data[home2][6]}}
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                    {%endfor%}
                    <a
                        class="carousel-control-prev"
                        href="#carouselExampleCaptions"
                        role="button"
                        data-slide="prev"
                    >
                        <span
                            class="carousel-control-prev-icon"
                            aria-hidden="true"
                        ></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a
                        class="carousel-control-next"
                        href="#carouselExampleCaptions"
                        role="button"
                        data-slide="next"
                    >
                        <span
                            class="carousel-control-next-icon"
                            aria-hidden="true"
                        ></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
            {%endif%}
            <!-- Hiển thị tất cả nhà trên bản đồ -->
            <script>
                mapboxgl.accessToken =
                    "pk.eyJ1IjoidnVseXRoaWVuYW5oIiwiYSI6ImNrZXlhNXd3ZDBkb2Myd3AzYWRxaXhodnIifQ.de-6twccJ_8Jte2Iy5xVqg";
                
                    var map = new mapboxgl.Map({
                    container: "map",
                    style: "mapbox://styles/mapbox/streets-v11",
                    center: [105.7225509, 10.0342696],
                    zoom: 10,
                });

                {%for local in range(0,lengthLocation)%};
                var marker{{local+1}} = new mapboxgl.Marker()
                    .setLngLat({{locationAll[local]}})
                    .setPopup(new mapboxgl.Popup({ offset: 25 }) // add popups
                    .setHTML('<h6><a target="_blank" href="./detail/{{dataRaw[local][0]}}">' + '{{(dataRaw[local][1])[0:40]}}...' + '</a></h6><p>' + 'Giá: {{dataRaw[local][2]}} | Diện tích: {{dataRaw[local][3]}}' + '</p><p>'+ 'Số PN: {{dataRaw[local][4]}} | Số Tầng: {{dataRaw[local][5]}}' +'</p><p>'+'Hướng nhà: {{dataRaw[local][6]}}'+'</p>'))
                    .addTo(map);
                {%endfor%};
                
                // Add geolocate control to the map.
                map.addControl(
                    new mapboxgl.GeolocateControl({
                        positionOptions: {
                            enableHighAccuracy: true
                        },
                        trackUserLocation: true
                    })
                );
            </script>
            <!-- END - Hiển thị tất cả nhà trên bản đồ -->
            <{{warning}}>
                alert("Quận huyện bạn chọn không tồn tại bản tin nào");
            </{{warning}}>
        </div>
    </div>
</div>
{% endblock %}
